<div class="main-container">
  <div class="sub-container">
    <ng-template #welcomeMessage>
      <h1 class="regards text-semibold">How can I assist you today?</h1>
    </ng-template>

    <section
      #chatArea
      *ngIf="messages.length > 0; else welcomeMessage"
      class="chat-area"
    >
      <ng-container *ngFor="let message of messages">
        <article *ngIf="message.role == messageRole.user" class="user-prompt">
          <div class="bubbles-actions">
            <div class="bubble-action">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M11.1 22.75H6.9C2.99 22.75 1.25 21.01 1.25 17.1V12.9C1.25 8.99 2.99 7.25 6.9 7.25H11.1C15.01 7.25 16.75 8.99 16.75 12.9V17.1C16.75 21.01 15.01 22.75 11.1 22.75ZM6.9 8.75C3.8 8.75 2.75 9.8 2.75 12.9V17.1C2.75 20.2 3.8 21.25 6.9 21.25H11.1C14.2 21.25 15.25 20.2 15.25 17.1V12.9C15.25 9.8 14.2 8.75 11.1 8.75H6.9Z"
                />
                <path
                  d="M17.1 16.75H16C15.59 16.75 15.25 16.41 15.25 16V12.9C15.25 9.8 14.2 8.75 11.1 8.75H8C7.59 8.75 7.25 8.41 7.25 8V6.9C7.25 2.99 8.99 1.25 12.9 1.25H17.1C21.01 1.25 22.75 2.99 22.75 6.9V11.1C22.75 15.01 21.01 16.75 17.1 16.75ZM16.75 15.25H17.1C20.2 15.25 21.25 14.2 21.25 11.1V6.9C21.25 3.8 20.2 2.75 17.1 2.75H12.9C9.8 2.75 8.75 3.8 8.75 6.9V7.25H11.1C15.01 7.25 16.75 8.99 16.75 12.9V15.25Z"
                />
              </svg>
            </div>
            <div class="bubble-action">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M5.53999 19.52C4.92999 19.52 4.35999 19.31 3.94999 18.92C3.42999 18.43 3.17999 17.69 3.26999 16.89L3.63999 13.65C3.70999 13.04 4.07999 12.23 4.50999 11.79L12.72 3.09999C14.77 0.929988 16.91 0.869988 19.08 2.91999C21.25 4.96999 21.31 7.10999 19.26 9.27999L11.05 17.97C10.63 18.42 9.84999 18.84 9.23999 18.94L6.01999 19.49C5.84999 19.5 5.69999 19.52 5.53999 19.52ZM15.93 2.90999C15.16 2.90999 14.49 3.38999 13.81 4.10999L5.59999 12.81C5.39999 13.02 5.16999 13.52 5.12999 13.81L4.75999 17.05C4.71999 17.38 4.79999 17.65 4.97999 17.82C5.15999 17.99 5.42999 18.05 5.75999 18L8.97999 17.45C9.26999 17.4 9.74999 17.14 9.94999 16.93L18.16 8.23999C19.4 6.91999 19.85 5.69999 18.04 3.99999C17.24 3.22999 16.55 2.90999 15.93 2.90999Z"
                />
                <path
                  d="M17.3399 10.95C17.3199 10.95 17.2899 10.95 17.2699 10.95C14.1499 10.64 11.6399 8.26997 11.1599 5.16997C11.0999 4.75997 11.3799 4.37997 11.7899 4.30997C12.1999 4.24997 12.5799 4.52997 12.6499 4.93997C13.0299 7.35997 14.9899 9.21997 17.4299 9.45997C17.8399 9.49997 18.1399 9.86997 18.0999 10.28C18.0499 10.66 17.7199 10.95 17.3399 10.95Z"
                />
                <path
                  d="M21 22.75H3C2.59 22.75 2.25 22.41 2.25 22C2.25 21.59 2.59 21.25 3 21.25H21C21.41 21.25 21.75 21.59 21.75 22C21.75 22.41 21.41 22.75 21 22.75Z"
                />
              </svg>
            </div>
          </div>
          <div class="prompt-bubble">
            <div [innerHTML]="message.content"></div>
          </div>
        </article>
        <article
          *ngIf="message.role == messageRole.assistant"
          class="ai-response"
        >
          <div class="ai-response-logo">
            <img
              src="../../../../../assets/icons/logo/svgs/sub-logo-black.svg"
              alt="Turbo"
            />
          </div>
          <div class="response-bubble">
            <div
              class="response-content"
              [innerHTML]="safeHtml(message.content)"
            ></div>

            <div class="bubbles-actions">
              <div class="bubble-action">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M11.1 22.75H6.9C2.99 22.75 1.25 21.01 1.25 17.1V12.9C1.25 8.99 2.99 7.25 6.9 7.25H11.1C15.01 7.25 16.75 8.99 16.75 12.9V17.1C16.75 21.01 15.01 22.75 11.1 22.75ZM6.9 8.75C3.8 8.75 2.75 9.8 2.75 12.9V17.1C2.75 20.2 3.8 21.25 6.9 21.25H11.1C14.2 21.25 15.25 20.2 15.25 17.1V12.9C15.25 9.8 14.2 8.75 11.1 8.75H6.9Z"
                  />
                  <path
                    d="M17.1 16.75H16C15.59 16.75 15.25 16.41 15.25 16V12.9C15.25 9.8 14.2 8.75 11.1 8.75H8C7.59 8.75 7.25 8.41 7.25 8V6.9C7.25 2.99 8.99 1.25 12.9 1.25H17.1C21.01 1.25 22.75 2.99 22.75 6.9V11.1C22.75 15.01 21.01 16.75 17.1 16.75ZM16.75 15.25H17.1C20.2 15.25 21.25 14.2 21.25 11.1V6.9C21.25 3.8 20.2 2.75 17.1 2.75H12.9C9.8 2.75 8.75 3.8 8.75 6.9V7.25H11.1C15.01 7.25 16.75 8.99 16.75 12.9V15.25Z"
                  />
                </svg>
              </div>
              <div class="bubble-action">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M20.4201 12.22C20.0101 12.22 19.6701 11.88 19.6701 11.47V8.15002C19.6701 6.91002 18.6601 5.90002 17.4201 5.90002H3.58008C3.17008 5.90002 2.83008 5.56002 2.83008 5.15002C2.83008 4.74002 3.17008 4.40002 3.58008 4.40002H17.4201C19.4901 4.40002 21.1701 6.08002 21.1701 8.15002V11.47C21.1701 11.89 20.8301 12.22 20.4201 12.22Z"
                  />
                  <path
                    d="M6.74008 9.06998C6.55008 9.06998 6.36008 8.99995 6.21008 8.84995L3.05008 5.68997C2.91008 5.54997 2.83008 5.35994 2.83008 5.15994C2.83008 4.95994 2.91008 4.76998 3.05008 4.62998L6.21008 1.46994C6.50008 1.17994 6.98008 1.17994 7.27008 1.46994C7.56008 1.75994 7.56008 2.24 7.27008 2.53L4.64011 5.15994L7.27008 7.78995C7.56008 8.07995 7.56008 8.55995 7.27008 8.84995C7.12008 8.98995 6.93008 9.06998 6.74008 9.06998Z"
                  />
                  <path
                    d="M20.4201 19.59H6.58008C4.51008 19.59 2.83008 17.91 2.83008 15.84V12.52C2.83008 12.11 3.17008 11.77 3.58008 11.77C3.99008 11.77 4.33008 12.11 4.33008 12.52V15.84C4.33008 17.08 5.34008 18.09 6.58008 18.09H20.4201C20.8301 18.09 21.1701 18.43 21.1701 18.84C21.1701 19.25 20.8301 19.59 20.4201 19.59Z"
                  />
                  <path
                    d="M17.2602 22.75C17.0702 22.75 16.8802 22.68 16.7302 22.53C16.4402 22.24 16.4402 21.7599 16.7302 21.4699L19.3602 18.84L16.7302 16.21C16.4402 15.92 16.4402 15.44 16.7302 15.15C17.0202 14.86 17.5002 14.86 17.7902 15.15L20.9502 18.31C21.0902 18.45 21.1702 18.64 21.1702 18.84C21.1702 19.04 21.0902 19.23 20.9502 19.37L17.7902 22.53C17.6502 22.68 17.4602 22.75 17.2602 22.75Z"
                  />
                </svg>
              </div>
              <div class="bubble-action">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M16.2799 22.1H12.4799C11.9199 22.1 10.6999 21.93 10.0499 21.28L7.01986 18.94L7.93986 17.75L11.0399 20.15C11.2899 20.39 11.9199 20.59 12.4799 20.59H16.2799C17.1799 20.59 18.1499 19.87 18.3499 19.06L20.7699 11.71C20.9299 11.27 20.8999 10.87 20.6899 10.58C20.4699 10.27 20.0699 10.09 19.5799 10.09H15.5799C15.0599 10.09 14.5799 9.86999 14.2499 9.48999C13.9099 9.09999 13.7599 8.57999 13.8399 8.03999L14.3399 4.82999C14.4599 4.26999 14.0799 3.63999 13.5399 3.45999C13.0499 3.27999 12.4199 3.53999 12.1999 3.85999L8.09986 9.95999L6.85986 9.12999L10.9599 3.02999C11.5899 2.08999 12.9699 1.63999 14.0499 2.04999C15.2999 2.45999 16.0999 3.83999 15.8199 5.11999L15.3299 8.26999C15.3199 8.33999 15.3199 8.43999 15.3899 8.51999C15.4399 8.56999 15.5099 8.59999 15.5899 8.59999H19.5899C20.5699 8.59999 21.4199 9.00999 21.9199 9.71999C22.4099 10.41 22.5099 11.32 22.1899 12.2L19.7999 19.48C19.4299 20.93 17.8899 22.1 16.2799 22.1Z"
                  />
                  <path
                    d="M5.37988 20.9999H4.37988C2.52988 20.9999 1.62988 20.1299 1.62988 18.3499V8.5499C1.62988 6.7699 2.52988 5.8999 4.37988 5.8999H5.37988C7.22988 5.8999 8.12988 6.7699 8.12988 8.5499V18.3499C8.12988 20.1299 7.22988 20.9999 5.37988 20.9999ZM4.37988 7.3999C3.28988 7.3999 3.12988 7.6599 3.12988 8.5499V18.3499C3.12988 19.2399 3.28988 19.4999 4.37988 19.4999H5.37988C6.46988 19.4999 6.62988 19.2399 6.62988 18.3499V8.5499C6.62988 7.6599 6.46988 7.3999 5.37988 7.3999H4.37988Z"
                  />
                </svg>
              </div>
              <div class="bubble-action">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M10.8 22.0999C10.51 22.0999 10.22 22.0499 9.95004 21.9499C8.70004 21.5399 7.90004 20.1599 8.18004 18.8799L8.67004 15.7299C8.68004 15.6599 8.68004 15.5599 8.61004 15.4799C8.56004 15.4299 8.49004 15.3999 8.41004 15.3999H4.41004C3.43004 15.3999 2.58004 14.9899 2.08004 14.2799C1.59004 13.5899 1.49004 12.6799 1.81004 11.7999L4.20004 4.5199C4.57004 3.0699 6.12004 1.8999 7.72004 1.8999H11.52C12.08 1.8999 13.3 2.0699 13.95 2.7199L16.98 5.0599L16.06 6.2499L12.96 3.8499C12.71 3.5999 12.08 3.3999 11.52 3.3999H7.72004C6.82004 3.3999 5.85004 4.1199 5.65004 4.9299L3.23004 12.2799C3.07004 12.7199 3.10004 13.1199 3.31004 13.4099C3.53004 13.7199 3.93004 13.8999 4.42004 13.8999H8.42004C8.94004 13.8999 9.42004 14.1199 9.75004 14.4999C10.09 14.8899 10.24 15.4099 10.16 15.9499L9.66004 19.1599C9.54004 19.7199 9.92004 20.3499 10.46 20.5299C10.94 20.7099 11.58 20.4499 11.8 20.1299L15.9 14.0299L17.14 14.8699L13.04 20.9699C12.57 21.6699 11.68 22.0999 10.8 22.0999Z"
                  />
                  <path
                    d="M19.6201 18.1H18.6201C16.7701 18.1 15.8701 17.23 15.8701 15.45V5.65C15.8701 3.87 16.7701 3 18.6201 3H19.6201C21.4701 3 22.3701 3.87 22.3701 5.65V15.45C22.3701 17.23 21.4701 18.1 19.6201 18.1ZM18.6201 4.5C17.5301 4.5 17.3701 4.76 17.3701 5.65V15.45C17.3701 16.34 17.5301 16.6 18.6201 16.6H19.6201C20.7101 16.6 20.8701 16.34 20.8701 15.45V5.65C20.8701 4.76 20.7101 4.5 19.6201 4.5H18.6201Z"
                  />
                </svg>
              </div>
            </div>
          </div>
        </article>
      </ng-container>
      <article *ngIf="waiting" class="ai-response ai-waiting">
        <div class="ai-response-logo">
          <img
            src="../../../../../assets/icons/logo/svgs/sub-logo-black.svg"
            alt="Turbo"
          />
        </div>
        <div class="response-bubble">
          <div class="la-ball-beat">
            <div></div>
            <div></div>
            <div></div>
          </div>
        </div>
      </article>
    </section>
    <section class="prompt-area">
      <form (ngSubmit)="onSubmit()">
        <textarea
          #promptInput
          name="user-prompt"
          class="form-control no-select prompt-input"
          rows="1"
          placeholder="Message Turbo"
          [(ngModel)]="userPrompt"
          (input)="adjustTextareaHeight($event)"
          (keydown.enter)="onSubmit(); $event.preventDefault()"
        ></textarea>

        <div class="d-flex align-items-center gap-1 w-100">
          <div class="attach-btn" (click)="openGuestLimitModalModal()">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M10.9714 22.75C7.25144 22.75 4.22144 19.72 4.22144 16V10C4.22144 5.73 7.70144 2.25 11.9714 2.25C16.2414 2.25 19.7214 5.73 19.7214 10V15.5C19.7214 17.84 17.8114 19.75 15.4714 19.75C13.1314 19.75 11.2214 17.84 11.2214 15.5V12C11.2214 11.59 11.5614 11.25 11.9714 11.25C12.3814 11.25 12.7214 11.59 12.7214 12V15.5C12.7214 17.02 13.9514 18.25 15.4714 18.25C16.9914 18.25 18.2214 17.02 18.2214 15.5V10C18.2214 6.55 15.4214 3.75 11.9714 3.75C8.52144 3.75 5.72144 6.55 5.72144 10V16C5.72144 18.89 8.07144 21.25 10.9714 21.25C11.3814 21.25 11.7214 21.59 11.7214 22C11.7214 22.41 11.3914 22.75 10.9714 22.75Z"
              />
            </svg>
          </div>

          <div class="options-btn" (click)="openGuestLimitModalModal()">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M11.0701 18.1701C10.9001 18.1701 10.7401 18.1401 10.5701 18.0801C10.0201 17.8701 9.66008 17.3601 9.66008 16.7701V13.4701H8.68008C8.12008 13.4701 7.63008 13.1501 7.40008 12.6501C7.17008 12.1401 7.26008 11.5701 7.63008 11.1501L11.8901 6.31012C12.2801 5.87012 12.8801 5.72012 13.4301 5.93012C13.9801 6.14012 14.3401 6.65012 14.3401 7.24012V10.5401H15.3301C15.8901 10.5401 16.3801 10.8601 16.6101 11.3601C16.8401 11.8701 16.7501 12.4401 16.3801 12.8601L12.1201 17.7001C11.8401 18.0001 11.4601 18.1701 11.0701 18.1701ZM8.90008 11.9701H10.4101C10.8201 11.9701 11.1601 12.3101 11.1601 12.7201V16.5001L15.1001 12.0301H13.5901C13.1801 12.0301 12.8401 11.6901 12.8401 11.2801V7.50012L8.90008 11.9701Z"
              />
              <path
                d="M11.97 22.75C6.04997 22.75 1.21997 17.93 1.21997 12C1.21997 6.07 6.04997 1.25 11.97 1.25C17.89 1.25 22.72 6.07 22.72 12C22.72 17.93 17.9 22.75 11.97 22.75ZM11.97 2.75C6.86997 2.75 2.71997 6.9 2.71997 12C2.71997 17.1 6.86997 21.25 11.97 21.25C17.07 21.25 21.22 17.1 21.22 12C21.22 6.9 17.07 2.75 11.97 2.75Z"
              />
            </svg>
          </div>

          <button
            [disabled]="
              !userPrompt || waiting || userPrompt.trim().length === 0
            "
            type="submit"
            class="x-btn submit-btn ms-auto"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="feather feather-arrow-up"
            >
              <line x1="12" y1="19" x2="12" y2="5"></line>
              <polyline points="5 12 12 5 19 12"></polyline>
            </svg>
          </button>
        </div>
      </form>
    </section>
  </div>
</div>

<ng-template #guestLimitModal let-modal>
  <div class="modal-body">
    <div class="x-modal-header">
      <span class="text-lg text-semibold">Turbo</span>
      <button
        type="button"
        class="btn-close ms-auto"
        aria-label="Close"
        (click)="modal.dismiss('Cross click')"
      ></button>
    </div>
    <hr />

    <div class="mb-3">
      <div class="text-lg text-medium mb-3">Try more features for free</div>

      <div class="text-sm">
        Get smarter responses, upload files, and more by logging in.
      </div>
    </div>

    <div class="d-flex align-items-center gap-2">
      <button
        class="x-btn w-100"
        routerLink="/auth/log-in"
        (click)="modal.dismiss('Cross click')"
      >
        Log in
      </button>
      <button
        class="x-btn-outline w-100"
        routerLink="/auth/sign-up"
        (click)="modal.dismiss('Cross click')"
      >
        Sign up
      </button>
    </div>
  </div>
</ng-template>

<app-toaster></app-toaster>
